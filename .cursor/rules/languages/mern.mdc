---
description: MERN stack development standards. Includes MongoDB, Express.js, React, and Node.js best practices, quality gates, project structure, and security. Apply when working with JavaScript/TypeScript files.
globs: *.js,*.jsx,*.ts,*.tsx,package.json,*.json
alwaysApply: false
---

# MERN Stack Development Standards

> **Note**: Assumes core rules (command execution, file operations, quality gates, error handling, naming) are already loaded.

## Quality Gates (MERN-Specific)
- All code must pass: `eslint`, `prettier`, `typescript` (if using TS), `jest`
- Test coverage >80% (use `npm run test -- --coverage`)
- Component documentation and PropTypes/TypeScript interfaces
- Use consistent code style across frontend and backend

## Project Structure (Atomic Design)

MERN-specific atomic design patterns (see `code-structure.mdc` for complete hierarchy and rules):

### React Frontend (Client)

#### Atoms (Basic Building Blocks)
- **Single-purpose components/utilities**: One component, one hook, or one utility per file
- **Size**: <100 lines (ideally <50 lines)
- **Location**: `client/src/atoms/`
- **Examples**:
  ```tsx
  // client/src/atoms/Button.tsx - Basic button component
  interface ButtonProps {
      label: string;
      onClick: () => void;
  }

  export const Button: React.FC<ButtonProps> = ({ label, onClick }) => (
      <button onClick={onClick}>{label}</button>
  );

  // client/src/atoms/useLocalStorage.ts - Single-purpose hook
  export const useLocalStorage = (key: string) => {
      // Implementation
  };
  ```

#### Molecules (Composed Components)
- **Compose atoms**: Import and use 2-5 atom components/hooks
- **Size**: <200 lines (ideally <150 lines)
- **Location**: `client/src/molecules/`
- **Examples**:
  ```tsx
  // client/src/molecules/LoginForm.tsx - Composes atoms
  import { Button } from '../atoms/Button';
  import { Input } from '../atoms/Input';
  import { useLocalStorage } from '../atoms/useLocalStorage';

  export const LoginForm: React.FC = () => {
      const [token, setToken] = useLocalStorage('token');
      // Composes Button and Input atoms
  };
  ```

#### Organisms (Complex Components)
- **Compose molecules/atoms**: Import multiple molecule components
- **Size**: <500 lines (ideally <300 lines)
- **Location**: `client/src/organisms/`
- **Examples**:
  ```tsx
  // client/src/organisms/AuthSystem.tsx - Complete auth system
  import { LoginForm } from '../molecules/LoginForm';
  import { RegisterForm } from '../molecules/RegisterForm';

  export const AuthSystem: React.FC = () => {
      // Composes LoginForm and RegisterForm molecules
  };
  ```

### Express Backend (Server)

#### Atoms (Basic Building Blocks)
- **Single-purpose utilities/models**: One function, one model, or one small utility per file
- **Size**: <100 lines (ideally <50 lines)
- **Location**: `server/src/atoms/`
- **Examples**:
  ```typescript
  // server/src/atoms/user.model.ts - Basic User model
  export interface User {
      id: number;
      email: string;
      name: string;
  }

  // server/src/atoms/validator.ts - Single-purpose validation
  export const validateEmail = (email: string): boolean => {
      return email.includes('@');
  };
  ```

#### Molecules (Composed Components)
- **Compose atoms**: Import and use 2-5 atoms
- **Size**: <200 lines (ideally <150 lines)
- **Location**: `server/src/molecules/`
- **Examples**:
  ```typescript
  // server/src/molecules/userValidator.ts - Composes atoms
  import { User } from '../atoms/user.model';
  import { validateEmail } from '../atoms/validator';

  export const validateUser = (user: User): [boolean, string] => {
      if (!validateEmail(user.email)) {
          return [false, 'Invalid email'];
      }
      return [true, 'Valid'];
  };
  ```

#### Organisms (Complex Modules)
- **Compose molecules/atoms**: Import multiple molecules
- **Size**: <500 lines (ideally <300 lines)
- **Location**: `server/src/organisms/`
- **Examples**:
  ```typescript
  // server/src/organisms/authController.ts - Complete auth controller
  import { validateUser } from '../molecules/userValidator';
  import { createToken } from '../molecules/tokenService';

  export class AuthController {
      // Composes userValidator and tokenService molecules
  }
  ```

### MERN-Specific Patterns
- **React**: Use functional components, hooks for atoms, compose into molecules/organisms
- **Express**: Use middleware for cross-cutting concerns, controllers as organisms
- **MongoDB**: Models as atoms, services as molecules, controllers as organisms
- Keep imports minimal - prefer composition over deep nesting
- Use TypeScript interfaces for type safety across composition

## MongoDB Best Practices
- Use Mongoose for schema validation and object modeling
- Implement proper indexing for query performance
- Use aggregation pipelines for complex queries
- Implement connection pooling and error handling
- Never expose database credentials in code

## Express.js Backend Standards
- Use middleware for cross-cutting concerns (auth, logging, CORS)
- Implement proper error handling with error middleware
- Use environment variables for configuration
- Implement request validation with libraries like Joi or express-validator
- Use async/await for database operations

## React Frontend Standards
- Use functional components with hooks
- Implement proper state management (Context API or Redux)
- Use custom hooks for reusable logic
- Implement proper error boundaries
- Use PropTypes or TypeScript for type checking
- Follow component composition patterns

## Security

MERN-specific security patterns (see `security.mdc` for universal security requirements):
- Use `process.env` for environment variables
- Use `dotenv` for `.env` file management (never commit `.env`)

## Testing (TDD)

MERN-specific TDD patterns (see `tdd-methodology.mdc` for core TDD principles):

### MERN Testing Tools
- **Backend**: Use Jest for unit and integration tests
- **Frontend**: Use Jest + React Testing Library for component tests
- **E2E**: Use Cypress or Playwright for end-to-end tests
- Mock external dependencies and API calls
- Use `jest --coverage` for coverage reports

### TDD Workflow Example (MERN)
```typescript
// Red: Write failing test first
test('validateEmail returns true for valid email', () => {
    expect(validateEmail('user@example.com')).toBe(true);
});

// Green: Write minimal code to pass
// Refactor: Improve while keeping tests green
```

## Dependencies
- Pin dependency versions in package.json
- Use `npm audit` to check for security vulnerabilities
- Keep dependencies minimal and well-justified
- Regular security updates
- Use lock files (package-lock.json) for reproducible builds
