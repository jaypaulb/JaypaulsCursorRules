---
description: Generic REST API client development standards. Covers authentication, request/response patterns, error handling, and atomic design structure for REST API clients. Apply when building REST API clients in any language.
globs: *api*.py,*api*.ts,*api*.js,*api*.go,*client*.py,*client*.ts,*client*.js,*client*.go
alwaysApply: false
---

# REST API Client Development Standards

> **Note**: This rule provides generic REST API patterns. For language-specific patterns, see language rules (Python, Go, TypeScript, etc.). For TDD methodology, see `tdd-methodology.mdc`. For atomic design structure, see `code-structure.mdc`.

## API Overview

### REST Principles

- **Stateless**: Each request contains all information needed
- **Resource-based**: URLs represent resources, not actions
- **HTTP methods**: Use GET, POST, PUT, PATCH, DELETE appropriately
- **Status codes**: Use standard HTTP status codes
- **JSON**: Use JSON for request/response bodies (typically)

### Base URL Structure

- All endpoints prefixed with base URL
- Version in URL path: `/api/v1/` or `/v1/`
- Resource-based paths: `/api/v1/users`, `/api/v1/users/:id`
- Nested resources: `/api/v1/users/:id/posts`

## Authentication

### Common Patterns

- **API Key**: Header `X-API-Key: <key>` or query parameter
- **Bearer Token**: Header `Authorization: Bearer <token>`
- **Basic Auth**: Header `Authorization: Basic <base64(user:pass)>`
- **Custom Header**: Header `Private-Token: <token>` (e.g., Canvus API)

### Token Management

- Store tokens securely (environment variables, not in code)
- Handle token expiration and refresh
- Support both temporary and permanent tokens
- Handle 401 Unauthorized errors gracefully

## HTTP Methods and Status Codes

### Standard Operations

- **GET**: Retrieve resource(s) - Returns `200 OK` with data
- **POST**: Create resource - Returns `200 OK` or `201 Created` with created resource
- **PUT**: Replace resource - Returns `200 OK` with updated resource
- **PATCH**: Update resource (partial) - Returns `200 OK` with updated resource
- **DELETE**: Delete resource - Returns `200 OK` or `204 No Content`

### Error Responses

- **400 Bad Request**: Invalid request data
- **401 Unauthorized**: Missing or invalid authentication
- **403 Forbidden**: Insufficient permissions
- **404 Not Found**: Resource doesn't exist
- **429 Too Many Requests**: Rate limit exceeded
- **500 Internal Server Error**: Server error

### Error Response Format

```json
{
  "error": "Error message",
  "code": "ERROR_CODE",
  "details": {}
}
```

## Code Structure (Atomic Design)

Structure REST API client code following atomic design hierarchy (see `code-structure.mdc` for general principles):

### Atoms (Basic Building Blocks)

- **Models**: Data models for API resources
- **Auth**: Authentication utilities (token management, header creation)
- **Exceptions**: Custom API error types
- **Size**: <100 lines each

### Molecules (Composed Components)

- **Resource Clients**: Each resource API client (UserClient, PostClient, etc.)
- **Compose atoms**: Import and use models, auth, exceptions
- **Size**: <200 lines each

### Organisms (Complex Modules)

- **Main Client**: Complete API client composing all resource clients
- **Compose molecules**: Import all resource clients
- **Size**: <500 lines

## Request/Response Patterns

### Request Headers

- `Content-Type: application/json` for JSON requests
- `Accept: application/json` for JSON responses
- Authentication headers (as required by API)
- Custom headers as needed

### Request Body

- JSON format for POST/PUT/PATCH requests
- Validate required fields before sending
- Handle optional fields appropriately

### Response Handling

- Parse JSON responses
- Handle different status codes
- Extract error messages from error responses
- Return appropriate data models (atoms)

## Error Handling

### API Error Patterns

- Create custom error types for API errors (language-appropriate)
- Handle HTTP errors appropriately
- Return meaningful error messages
- Log errors without exposing sensitive data
- Use language-appropriate error handling patterns

### Error Types

```python
# Python example
class APIError(Exception):
    """Base exception for API errors."""
    pass

class AuthenticationError(APIError):
    """Authentication failed."""
    pass
```

```typescript
// TypeScript example
export class APIError extends Error {
  constructor(message: string) {
    super(message);
    this.name = 'APIError';
  }
}
```

```go
// Go example
var (
    ErrAPI = errors.New("API error")
    ErrAuthentication = errors.New("authentication failed")
)
```

## Testing (TDD)

Follow TDD methodology (see `tdd-methodology.mdc` for core principles):

### TDD Workflow (REST API)

1. **Red**: Write failing test first (test API client method)
2. **Green**: Write minimal code to pass
3. **Refactor**: Improve code while keeping tests green

### Test Structure (Atomic Design)

- **Atoms**: Unit tests for models/auth/utilities - test in isolation
- **Molecules**: Integration tests for resource clients - test with mocked HTTP
- **Organisms**: System tests for main client - test with mocked molecules

### Test Requirements

- Write tests before implementation (TDD)
- Test coverage >80% (100% for public APIs)
- Mock HTTP requests appropriately for the language
- Test atoms in isolation
- Test molecules with mocked atoms
- Test organisms with mocked molecules
- Test error handling and edge cases
- Test authentication and token handling

## Security

- Never commit API tokens or credentials
- Use environment variables for configuration
- Validate all inputs before sending to API
- Sanitize outputs from API responses
- Handle sensitive data appropriately
- Use HTTPS for all API communications
- Store tokens securely (not in code)

## Performance

- Use async/await or appropriate concurrency patterns for the language
- Implement connection pooling (language-appropriate)
- Cache frequently accessed resources when appropriate
- Use request batching when supported by API
- Use language-appropriate performance optimizations

## Documentation

- Document all public API methods
- Include parameter types and return types
- Provide usage examples
- Document authentication requirements
- Document error conditions
- Use language-appropriate documentation formats
